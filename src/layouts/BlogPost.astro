---
import { type CollectionEntry, render } from "astro:content";
import SeriesPanel from "@/components/SeriesPanel.astro";
import MastheadReact from "@/components/blog/MastheadReact.astro";
import PostFooterReact from "@/components/blog/PostFooterReact.astro";
import BackToTopButtonReact from "@/components/BackToTopButtonReact.astro";
import KeepReadingSection from "@/components/KeepReadingSection.astro";
import { Icon } from "astro-icon/components";
import PageLayout from "@/layouts/Base.astro";
import { cn } from "@/lib/utils";

interface Props {
	post: CollectionEntry<"post">;
}

const { post } = Astro.props;
const { ogImage, title, description, updatedDate, publishDate, seriesId } = post.data;

const socialImage = ogImage ?? `/og-image/${post.id}.png`;
const articleDate = updatedDate?.toISOString() ?? publishDate.toISOString();
const { headings } = await render(post);
---

<PageLayout meta={{ articleDate, description, ogImage: socialImage, title }}>

	<MastheadReact content={post} />
	
	<div class={cn(
		"mt-6 flex gap-x-8 justify-center",
		"w-screen md:w-full"
	)}>
		<article class={cn(
			"grid grid-cols-1 break-words pt-4",
			"px-4 md:px-0"
		)} data-pagefind-body>
			<div class={cn(
				// Layout
				"justify-center w-[100%] mx-auto",
				"max-w-screen md:max-w-5xl",
				
				// Prose base
				"prose prose-citrus",
				
				// Headings
				"prose-headings:font-semibold prose-headings:text-slate-950",
				"md:prose-headings:max-w-3xl md:prose-headings:mx-auto",

				// Lists
				"md:prose-li:max-w-3xl md:prose-li:mx-auto",

				// Blockquotes
				"md:prose-blockquote:max-w-3xl md:prose-blockquote:mx-auto",

				// Tables - container with horizontal scroll
				"[&_table]:w-full md:[&_table]:w-fit [&_table]:max-w-3xl [&_table]:mx-auto",
				"[&_table]:overflow-x-auto [&_table]:block [&_table]:whitespace-nowrap",
				"[&_table]:border-collapse [&_table]:border-spacing-0",
				"[&_td]:whitespace-nowrap [&_th]:whitespace-nowrap",
				"[&_td]:px-3 [&_td]:py-2 [&_th]:px-3 [&_th]:py-2",
				"sm:prose-th:before:content-none",
				"[&_td]:text-xs [&_th]:text-xs md:[&_td]:text-base md:[&_th]:text-base",

				// Paragraphs
				"prose-p:text-justify prose-p:text-xs md:prose-p:text-base",
				"md:prose-p:max-w-3xl md:prose-p:mx-auto",
				
				// Inline Code
				"prose-code:bg-gray-100 prose-code:text-red-600 prose-code:px-1",
				"prose-code:rounded-sm prose-code:text-sm prose-code:font-semibold",
				"prose-code:leading-none prose-code:align-baseline",
				"prose-code:before:content-none prose-code:after:content-none", // Remove default quotes
				"[&_:not(pre)>code]:py-0 [&_:not(pre)>code]:my-0",
				
				// Strong
				"md:prose-strong:max-w-3xl md:prose-strong:mx-auto",

				// Summary
				"md:prose-summary:max-w-3xl md:prose-summary:mx-auto",

				// Ins tags (for model names/emphasis)
				"[&_ins]:max-w-3xl [&_ins]:mx-auto [&_ins]:block",

				// Iframes
				"[&:has(>iframe)]:aspect-video [&:has(>iframe)]:w-full [&:has(>iframe)]:max-w-3xl [&:has(>iframe)]:mx-auto",
				"[&_iframe]:aspect-video [&_iframe]:w-full md:[&_iframe]:max-w-3xl md:[&_iframe]:mx-auto",
			)}>
				<slot />
			</div>
		</article>
	</div>

	

	<PostFooterReact content={post} />

	<KeepReadingSection currentPost={post} />

	<BackToTopButtonReact />
</PageLayout>
